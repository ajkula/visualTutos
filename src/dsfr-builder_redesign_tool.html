<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Planificateur de composants DSFR</title>
  <script src="https://unpkg.com/react@17/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@17/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      line-height: 1.6;
      margin: 0;
      padding: 20px;
      background-color: #f0f0f0;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      background-color: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    button {
      background-color: #4CAF50;
      border: none;
      color: white;
      padding: 10px 20px;
      cursor: pointer;
      margin: 5px;
      border-radius: 4px;
      transition: background-color 0.3s;
    }

    button:hover {
      background-color: #45a049;
    }

    input,
    select {
      width: 100%;
      padding: 10px;
      margin-bottom: 10px;
      border: 1px solid #ddd;
      border-radius: 4px;
    }

    .component-item {
      display: flex;
      flex-direction: column;
      border: 1px solid #ddd;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 4px;
      background-color: #f9f9f9;
    }

    .space-between {
      display: flex;
      flex-direction: row;
      justify-content: space-between;
      align-items: baseline;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      max-width: 500px;
      width: 100%;
    }

    .checkbox-container {
      display: flex;
      align-items: center;
      margin-bottom: 5px;
    }

    .checkbox-container input[type="checkbox"] {
      margin-right: 10px;
      width: auto;
    }

    .trait-container {
      display: flex;
      gap: 10px;
      margin-bottom: 10px;
    }

    .trait-container input,
    .trait-container select {
      flex: 1;
    }

    p {
      margin-top: 5px;
      margin-bottom: 5px;
    }

    h2,
    h3,
    h4 {
      margin-top: 10px;
      margin-bottom: 10px;
    }

    /* searchable */
    .list-container {
      width: 48%;
    }

    .searchable-component-list {
      height: 350px;
      display: flex;
      flex-direction: column;
    }

    .search-input {
      margin-bottom: 10px;
      padding: 8px;
      font-size: 16px;
    }

    .component-list-container {
      flex-grow: 1;
      overflow-y: auto;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .component-item {
      padding: 8px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
    }

    .component-item:hover {
      background-color: #f0f0f0;
    }

    /* draggable */
    .draggable {
      cursor: grab;
    }

    .draggable:active {
      cursor: grabbing;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/javascript">
    (function () {
      function escapeHtml(unsafe) {
        return unsafe
          .replace(/&/g, "&amp;")
          .replace(/</g, "&lt;")
          .replace(/>/g, "&gt;")
          .replace(/"/g, "&quot;")
          .replace(/'/g, "&#039;");
      }

      function generateHTMLDocumentation(savedComponents, allComponents) {
        let doc = '<!DOCTYPE html>\n<html lang="fr">\n<head>\n';
        doc += '<meta charset="UTF-8">\n<title>Documentation des composants DSFR</title>\n';
        doc += '<style>\n';
        doc += 'body { font-family: Arial, sans-serif; line-height: 1.6; color: #333; background-color: #f0f0f0; margin: 0; padding: 20px; }\n';
        doc += '.container { max-width: 1200px; margin: 0 auto; background-color: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }\n';
        doc += 'h1 { text-align: center; }\n';
        doc += '.accordion { margin-bottom: 10px; background-color: white; }\n';
        doc += '.accordion summary { cursor: pointer; font-weight: bold; }\n';
        doc += '.accordion-content { padding: 10px; border: 1px solid #ddd; }\n';
        doc += '.svg-container { width: 800px; height: 600px; border: 1px solid #ccc; margin: 0 auto 10px; overflow: hidden; }\n';
        doc += '.draggable { cursor: grab; }\n';
        doc += '.draggable:active { cursor: grabbing; }\n';
        doc += '</style>\n</head>\n<body>\n';
        doc += '<h1>Documentation des composants DSFR</h1>\n';
        doc += '<div class="container">\n';

        savedComponents.forEach(function (component) {
          doc += '<details class="accordion">\n';
          doc += '<summary>' + escapeHtml(component.name) + '</summary>\n';
          doc += '<div class="accordion-content">\n';
          doc += '<p><strong>Type:</strong> ' + escapeHtml(component.type) + '</p>\n';
          doc += '<h3>Enfants autorisés:</h3>\n<ul>\n';
          component.allowedChildren.forEach(function (childId) {
            const childName = allComponents.find(function (c) { return c.id === childId; });
            const childNameEscaped = childName ? escapeHtml(childName.name) : escapeHtml(childId);
            doc += '<li>' + childNameEscaped + '</li>\n';
          });
          doc += '</ul>\n<h3>Traits:</h3>\n<ul>\n';
          component.traits.forEach(function (trait) {
            doc += '<li>' + escapeHtml(trait.name) + ': ' + escapeHtml(trait.type) + '</li>\n';
          });
          doc += '</ul>\n';
          doc += '<div class="svg-container" id="svg-' + escapeHtml(component.id) + '"></div>\n';
          doc += '</div>\n</details>\n';
        });

        doc += '</div>\n';  // Closing container div
        doc += '<script>\n';
        doc += '(function() {\n';

        doc += 'function generateVisualComponentGraph(component, allComponents, containerId) {\n';
        doc += '  console.log(containerId);\n';
        doc += '  const svgWidth = 800, svgHeight = 600;\n';
        doc += '  const mainBlockWidth = 300, mainBlockHeight = 200;\n';
        doc += '  const subBlockWidth = 150, subBlockHeight = 80;\n';
        doc += '  const spacing = 30, arrowWidth = 2;\n';
        doc += '  const mainBlockX = svgWidth / 2 - mainBlockWidth / 2;\n';
        doc += '  const mainBlockY = svgHeight / 2 - mainBlockHeight / 2;\n';
        doc += '  const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");\n';
        doc += '  svg.setAttribute("width", svgWidth);\n';
        doc += '  svg.setAttribute("height", svgHeight);\n';
        doc += '  svg.innerHTML = \'<defs><marker id="arrowhead-\' + component.id + \'" markerWidth="10" markerHeight="7" refX="0" refY="3.5" orient="auto"><polygon points="0 0, 10 3.5, 0 7" fill="#2E7D32" /></marker></defs>\';\n';
        doc += '  const g = document.createElementNS("http://www.w3.org/2000/svg", "g");\n';
        doc += '  g.setAttribute("id", "component-graph-" + component.id);\n';
        doc += '  g.setAttribute("class", "draggable");\n';
        doc += '  g.innerHTML = renderBlock(mainBlockX, mainBlockY, mainBlockWidth, mainBlockHeight, component.name || "Composant sans nom", true);\n';
        doc += '  g.innerHTML += renderConfigBlocks(component, mainBlockY, subBlockHeight, spacing, subBlockWidth);\n';
        doc += '  g.innerHTML += renderChildrenBlocks(component, allComponents, svgWidth, mainBlockY, subBlockHeight, spacing, subBlockWidth);\n';
        doc += '  g.innerHTML += renderArrows(component, svgWidth, mainBlockX, mainBlockY, mainBlockWidth, mainBlockHeight, subBlockWidth, subBlockHeight, spacing);\n';
        doc += '  svg.appendChild(g);\n';
        doc += '  document.getElementById(containerId).appendChild(svg);\n';
        doc += '  setupDraggable(g);\n';
        doc += '}\n';

        doc += 'function renderBlock(x, y, width, height, text, isMain) {\n';
        doc += '  return \'<g><rect x="\' + x + \'" y="\' + y + \'" width="\' + width + \'" height="\' + height + \'" rx="10" ry="10" fill="\' + (isMain ? "#4CAF50" : "#81C784") + \'" stroke="#2E7D32" stroke-width="2" /><text x="\' + (x + width / 2) + \'" y="\' + (y + height / 2) + \'" text-anchor="middle" dominant-baseline="middle" fill="white" font-size="\' + (isMain ? 16 : 14) + \'">\' + text + \'</text></g>\';\n';
        doc += '}\n';

        doc += 'function renderConfigBlocks(component, mainBlockY, subBlockHeight, spacing, subBlockWidth) {\n';
        doc += '  return (component.traits || []).map(function(trait, index) {\n';
        doc += '    const x = spacing;\n';
        doc += '    const y = mainBlockY + (subBlockHeight + 5) * index;\n';
        doc += '    return renderBlock(x, y, subBlockWidth, subBlockHeight, trait.name + ": " + trait.type);\n';
        doc += '  }).join("");\n';
        doc += '}\n';

        doc += 'function renderChildrenBlocks(component, allComponents, svgWidth, mainBlockY, subBlockHeight, spacing, subBlockWidth) {\n';
        doc += '  return (component.allowedChildren || []).map(function(childId, index) {\n';
        doc += '    const childName = allComponents.find(function(c) { return c.id === childId; });\n';
        doc += '    const childNameStr = childName ? childName.name : childId;\n';
        doc += '    const x = svgWidth - spacing - subBlockWidth;\n';
        doc += '    const y = mainBlockY + (subBlockHeight + 5) * index;\n';
        doc += '    return renderBlock(x, y, subBlockWidth, subBlockHeight, childNameStr);\n';
        doc += '  }).join("");\n';
        doc += '}\n';

        doc += 'function renderArrows(component, svgWidth, mainBlockX, mainBlockY, mainBlockWidth, mainBlockHeight, subBlockWidth, subBlockHeight, spacing) {\n';
        doc += '  const configArrows = (component.traits || []).map(function(_, index) {\n';
        doc += '    return \'<line x1="\' + (spacing + subBlockWidth) + \'" y1="\' + (mainBlockY + (subBlockHeight + 5) * index + subBlockHeight / 2) + \'" x2="\' + mainBlockX + \'" y2="\' + (mainBlockY + mainBlockHeight / 2) + \'" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrowhead-\' + component.id + \')" />\';\n';
        doc += '  }).join("");\n';
        doc += '  const childrenArrows = (component.allowedChildren || []).map(function(_, index) {\n';
        doc += '    return \'<line x1="\' + (mainBlockX + mainBlockWidth) + \'" y1="\' + (mainBlockY + mainBlockHeight / 2) + \'" x2="\' + (svgWidth - spacing - subBlockWidth) + \'" y2="\' + (mainBlockY + (subBlockHeight + 5) * index + subBlockHeight / 2) + \'" stroke="#2E7D32" stroke-width="2" marker-end="url(#arrowhead-\' + component.id + \')" />\';\n';
        doc += '  }).join("");\n';
        doc += '  return configArrows + childrenArrows;\n';
        doc += '}\n';

        doc += 'function setupDraggable(element) {\n';
        doc += '  const svg = element.ownerSVGElement;\n';
        doc += '  let isDragging = false;\n';
        doc += '  let startX, startY;\n';
        doc += '  const currentTransform = { x: 0, y: 0 };\n';

        doc += '  element.addEventListener("mousedown", startDrag);\n';
        doc += '  document.addEventListener("mousemove", drag);\n';
        doc += '  document.addEventListener("mouseup", endDrag);\n';

        doc += '  function getMousePosition(evt) {\n';
        doc += '    const CTM = svg.getScreenCTM();\n';
        doc += '    return {\n';
        doc += '      x: (evt.clientX - CTM.e) / CTM.a,\n';
        doc += '      y: (evt.clientY - CTM.f) / CTM.d\n';
        doc += '    };\n';
        doc += '  }\n';

        doc += '  function startDrag(evt) {\n';
        doc += '    if (evt.target === element || element.contains(evt.target)) {\n';
        doc += '      isDragging = true;\n';
        doc += '      const mousePos = getMousePosition(evt);\n';
        doc += '      startX = mousePos.x - currentTransform.x;\n';
        doc += '      startY = mousePos.y - currentTransform.y;\n';
        doc += '      evt.preventDefault();\n';
        doc += '    }\n';
        doc += '  }\n';

        doc += '  function drag(evt) {\n';
        doc += '    if (isDragging) {\n';
        doc += '      evt.preventDefault();\n';
        doc += '      const mousePos = getMousePosition(evt);\n';
        doc += '      currentTransform.x = mousePos.x - startX;\n';
        doc += '      currentTransform.y = mousePos.y - startY;\n';
        doc += '      element.setAttribute("transform", "translate(" + currentTransform.x + "," + currentTransform.y + ")");\n';
        doc += '    }\n';
        doc += '  }\n';

        doc += '  function endDrag(evt) {\n';
        doc += '    isDragging = false;\n';
        doc += '  }\n';
        doc += '}\n';

        doc += 'const savedComponents = ' + JSON.stringify(savedComponents) + ';\n';
        doc += 'const allComponents = ' + JSON.stringify(allComponents) + ';\n';
        doc += 'document.addEventListener("DOMContentLoaded", function() {\n';
        doc += '  savedComponents.forEach(function(component) {\n';
        doc += '    generateVisualComponentGraph(component, allComponents, "svg-" + component.id);\n';
        doc += '  });\n';
        doc += '});\n';

        doc += '})();\n';
        doc += '<\/script>\n';
        doc += '</body>\n</html>';

        return doc;
      }

      window.downloadHTMLDocumentation = function (savedComponents, allComponents) {
        const doc = generateHTMLDocumentation(savedComponents, allComponents);
        const blob = new Blob([doc], { type: 'text/html' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'dsfr-components-documentation.html';
        a.click();
      };
    })();
  </script>

  <script type="text/babel">
    const { useState, useRef, useMemo, useEffect } = React;

    // composants UI de base
    const Button = ({ children, onClick }) => (
      <button onClick={onClick}>{children}</button>
    );

    const Input = ({ value, onChange, placeholder }) => (
      <input value={value} onChange={onChange} placeholder={placeholder} />
    );

    const Select = ({ value, onChange, options }) => (
      <select value={value} onChange={onChange}>
        {options.map(option => (
          <option key={option.value} value={option.value}>{option.label}</option>
        ))}
      </select>
    );

    const Checkbox = ({ id, checked, onChange, label }) => (
      <div className="checkbox-container">
        <input type="checkbox" id={id} checked={checked} onChange={onChange} />
        <label htmlFor={id}>{label}</label>
      </div>
    );

    const AllowedChildrenList = ({ allowedChildren, setAllowedChildren }) => (
      <div>
        <h4>Enfants autorisés</h4>
        <SearchableComponentList
          components={allComponents}
          onSelectComponent={(component) => {
            if (allowedChildren.includes(component.id)) {
              setAllowedChildren(allowedChildren.filter(id => id !== component.id));
            } else {
              setAllowedChildren([...allowedChildren, component.id]);
            }
          }}
          renderItem={(component) => (
            <div key={component.id} className="flex items-center space-x-2">
              <Checkbox
                label={component.name}
                id={`child-${component.id}`}
                checked={allowedChildren.includes(component.id)}
                onChange={() => { }}
              />
            </div>
          )}
        />
      </div>
    );

    const SearchableComponentList = ({ components, onSelectComponent, renderItem }) => {
      const [searchTerm, setSearchTerm] = useState('');

      const filteredComponents = useMemo(() => {
        return components.filter(component =>
          Object.values(component).some(value =>
            value.toString().toLowerCase().includes(searchTerm.toLowerCase())
          )
        );
      }, [components, searchTerm]);

      return (
        <div className="searchable-component-list">
          <input
            type="text"
            placeholder="Rechercher un composant..."
            value={searchTerm}
            onChange={(e) => setSearchTerm(e.target.value)}
            className="w-full p-2 mb-2 border rounded"
          />
          <div className="component-list-container max-h-96 overflow-y-auto">
            {filteredComponents.map(component => (
              <div key={component.id} onClick={() => onSelectComponent(component)}>
                {renderItem(component)}
              </div>
            ))}
          </div>
        </div>
      );
    };

    const ComponentLists = ({ allComponents, onSelectComponent }) => {
      const buttons = allComponents.filter(c => c.type === 'button' || c.id.includes('button'));
      const checkboxes = allComponents.filter(c => c.type === 'checkbox' || c.id.includes('checkbox'));

      return (
        <div className="component-lists">
          <div className="list-container">
            <h3>Boutons</h3>
            <SearchableComponentList
              components={buttons}
              onSelectComponent={onSelectComponent}
            />
          </div>
          <div className="list-container">
            <h3>Cases à cocher</h3>
            <SearchableComponentList
              components={checkboxes}
              onSelectComponent={onSelectComponent}
            />
          </div>
        </div>
      );
    };

    const VisualComponentGraph = ({ component }) => {
      if (!component) return null;

      const [position, setPosition] = useState({ x: 0, y: 0 });
      const [isDragging, setIsDragging] = useState(false);
      const [startPosition, setStartPosition] = useState({ x: 0, y: 0 });
      const svgRef = useRef(null);

      const svgWidth = 800;
      const svgHeight = 600;
      const mainBlockWidth = 300;
      const mainBlockHeight = 200;
      const subBlockWidth = 150;
      const subBlockHeight = 80;
      const spacing = 30;
      const arrowWidth = 2;

      const mainBlockX = svgWidth / 2 - mainBlockWidth / 2;
      const mainBlockY = svgHeight / 2 - mainBlockHeight / 2;

      const renderBlock = (x, y, width, height, text, isMain = false) => (
        <g key={text}>
          <rect
            x={x}
            y={y}
            width={width}
            height={height}
            rx={10}
            ry={10}
            fill={isMain ? "#4CAF50" : "#81C784"}
            stroke="#2E7D32"
            strokeWidth={2}
          />
          <text
            x={x + width / 2}
            y={y + height / 2}
            textAnchor="middle"
            dominantBaseline="middle"
            fill="white"
            fontSize={isMain ? 16 : 14}
          >
            {text}
          </text>
        </g>
      );

      const renderArrow = (startX, startY, endX, endY) => (
        <line
          x1={startX}
          y1={startY}
          x2={endX}
          y2={endY}
          stroke="#2E7D32"
          strokeWidth={arrowWidth}
          markerEnd="url(#arrowhead)"
        />
      );

      const configBlocks = (component.traits || []).map((trait, index) => {
        const x = spacing;
        const y = mainBlockY + (subBlockHeight + 5) * index;
        return renderBlock(x, y, subBlockWidth, subBlockHeight, `${trait.name}: ${trait.type}`);
      });

      const childrenBlocks = (component.allowedChildren || []).map((childId, index) => {
        const childName = allComponents.find(c => c.id === childId)?.name || childId;
        const x = svgWidth - spacing - subBlockWidth;
        const y = mainBlockY + (subBlockHeight + 5) * index;
        return renderBlock(x, y, subBlockWidth, subBlockHeight, childName);
      });

      const handleMouseDown = (e) => {
        if (e.button !== 0) return; //left mouse button only
        setIsDragging(true);
        setStartPosition({
          x: e.clientX - position.x,
          y: e.clientY - position.y
        });
      };

      const handleMouseMove = (e) => {
        if (!isDragging) return;
        setPosition({
          x: e.clientX - startPosition.x,
          y: e.clientY - startPosition.y
        });
      };

      const handleMouseUp = () => {
        setIsDragging(false);
      };

      useEffect(() => {
        if (isDragging) {
          document.addEventListener('mousemove', handleMouseMove);
          document.addEventListener('mouseup', handleMouseUp);
        } else {
          document.removeEventListener('mousemove', handleMouseMove);
          document.removeEventListener('mouseup', handleMouseUp);
        }
        return () => {
          document.removeEventListener('mousemove', handleMouseMove);
          document.removeEventListener('mouseup', handleMouseUp);
        };
      }, [isDragging]);

      return (
        <svg
          width={svgWidth}
          height={svgHeight}
          ref={svgRef}
          style={{ overflow: 'hidden' }}
        >
          <defs>
            <marker
              id="arrowhead"
              markerWidth="10"
              markerHeight="7"
              refX="0"
              refY="3.5"
              orient="auto"
            >
              <polygon points="0 0, 10 3.5, 0 7" fill="#2E7D32" />
            </marker>
          </defs>
          <g
            id="component-graph"
            className="draggable"
            transform={`translate(${position.x}, ${position.y})`}
            onMouseDown={handleMouseDown}
          >
            {renderBlock(mainBlockX, mainBlockY, mainBlockWidth, mainBlockHeight, component.name || 'Composant sans nom', true)}
            {configBlocks}
            {childrenBlocks}
            {configBlocks.map((_, index) =>
              renderArrow(
                spacing + subBlockWidth,
                mainBlockY + (subBlockHeight + 5) * index + subBlockHeight / 2,
                mainBlockX,
                mainBlockY + mainBlockHeight / 2
              )
            )}
            {childrenBlocks.map((_, index) =>
              renderArrow(
                mainBlockX + mainBlockWidth,
                mainBlockY + mainBlockHeight / 2,
                svgWidth - spacing - subBlockWidth,
                mainBlockY + (subBlockHeight + 5) * index + subBlockHeight / 2
              )
            )}
          </g>
        </svg>
      );
    };

    // config des composants DSFR
    const allComponents = [
      // Composants atomiques
      { id: 'button', name: 'Bouton', type: 'atomique' },
      { id: 'link', name: 'Lien', type: 'atomique' },
      { id: 'checkbox', name: 'Case à cocher', type: 'atomique' },
      { id: 'radio', name: 'Bouton radio', type: 'atomique' },
      { id: 'input', name: 'Champ de saisie', type: 'atomique' },
      { id: 'label', name: 'Libellé', type: 'atomique' },
      { id: 'select', name: 'Sélecteur', type: 'atomique' },
      { id: 'badge', name: 'Badge', type: 'atomique' },
      { id: 'tag', name: 'Tag', type: 'atomique' },
      { id: 'title', name: 'Titre', type: 'atomique' },
      { id: 'paragraph', name: 'Paragraphe', type: 'atomique' },
      { id: 'image', name: 'Image', type: 'atomique' },
      { id: 'pictogram', name: 'Pictogramme', type: 'atomique' },
      { id: 'separator', name: 'Séparateur', type: 'atomique' },

      // Composants composés
      { id: 'search', name: 'Barre de recherche', type: 'composé' },
      { id: 'button-group', name: 'Groupe de boutons', type: 'composé' },
      { id: 'breadcrumb', name: 'Fil d\'Ariane', type: 'composé' },
      { id: 'alert', name: 'Alerte', type: 'composé' },
      { id: 'badge-group', name: 'Groupe de badges', type: 'composé' },
      { id: 'callout', name: 'Mise en avant', type: 'composé' },
      { id: 'connect', name: 'Connexion', type: 'composé' },
      { id: 'consent', name: 'Consentement', type: 'composé' },
      { id: 'cookies-disabled', name: 'Cookies désactivés', type: 'composé' },
      { id: 'follow', name: 'Suivre', type: 'composé' },
      { id: 'footer', name: 'Pied de page', type: 'composé' },
      { id: 'footer-operator', name: 'Pied de page opérateur', type: 'composé' },
      { id: 'header', name: 'En-tête', type: 'composé' },
      { id: 'highlight', name: 'Mise en évidence', type: 'composé' },
      { id: 'logo', name: 'Logo', type: 'composé' },
      { id: 'skiplinks', name: 'Liens d\'évitement', type: 'composé' },
      { id: 'tabs', name: 'Onglets', type: 'composé' },
      { id: 'tag-group', name: 'Groupe de tags', type: 'composé' },
      { id: 'quote', name: 'Citation', type: 'composé' },
      { id: 'card', name: 'Carte', type: 'composé' },
      { id: 'stepper', name: 'Étapes', type: 'composé' },
      { id: 'input-group', name: 'Groupe de champs', type: 'composé' },
      { id: 'modal', name: 'Fenêtre modale', type: 'composé' },
      { id: 'notice', name: 'Avis', type: 'composé' },
      { id: 'share', name: 'Partage', type: 'composé' },
      { id: 'accordion', name: 'Accordéon', type: 'composé' },
      { id: 'side-menu', name: 'Menu latéral', type: 'composé' },
      { id: 'toggle', name: 'Interrupteur', type: 'composé' },
      { id: 'toggle-group', name: 'Groupe d\'interrupteurs', type: 'composé' },
      { id: 'download-card', name: 'Carte de téléchargement', type: 'composé' },
      { id: 'pagination', name: 'Pagination', type: 'composé' },
      { id: 'tile', name: 'Tuile', type: 'composé' },
      { id: 'summary', name: 'Sommaire', type: 'composé' },
      { id: 'languages_selector', name: 'Sélecteur de langues', type: 'composé' },
      { id: 'upload', name: 'Téléversement', type: 'composé' },
      { id: 'table', name: 'Tableau', type: 'composé' },
      { id: 'table-rich', name: 'Tableau enrichi', type: 'composé' },

      // Composants de structure
      { id: 'container', name: 'Conteneur', type: 'structure' },
      { id: 'container-fluid', name: 'Conteneur fluide', type: 'structure' },
      { id: 'row', name: 'Ligne', type: 'structure' },
      { id: 'form', name: 'Formulaire (container)', type: 'structure' },

      // Composants de formulaire spécifiques
      { id: 'checkboxgroup', name: 'Groupe de cases à cocher', type: 'composé' },
      { id: 'radiogroup', name: 'Groupe de boutons radio', type: 'composé' },
      { id: 'radio-rich', name: 'Bouton radio riche', type: 'composé' },
      { id: 'radio-rich-group', name: 'Groupe de boutons radio riches', type: 'composé' },
      { id: 'name-form', name: 'Champ de nom', type: 'composé' },
      { id: 'phone-form', name: 'Champ de téléphone', type: 'composé' },
      { id: 'email-form', name: 'Champ d\'email', type: 'composé' },
      { id: 'password-form', name: 'Champ de mot de passe', type: 'composé' },
    ];

    const ComponentList = ({ onSelectComponent }) => (
      <div>
        <h2>Composants DSFR</h2>
        <SearchableComponentList
          components={allComponents}
          onSelectComponent={onSelectComponent}
          renderItem={(component) => (
            <div key={component.id} className="p-2 border rounded cursor-pointer hover:bg-gray-100">
              <h3 className="font-semibold">{component.name}</h3>
              <p className="text-sm text-gray-600">Type: {component.type}</p>
            </div>
          )}
        />
      </div>
    );

    const ComponentEditor = ({ component, onSave }) => {
      const [name, setName] = useState(component?.name || '');
      const [type, setType] = useState(component?.type || 'atomique');
      const [allowedChildren, setAllowedChildren] = useState(component?.allowedChildren || []);
      const [traits, setTraits] = useState(component?.traits || []);

      const handleSave = () => {
        onSave({ id: component?.id || Date.now().toString(), name, type, allowedChildren, traits });
      };

      return (
        <div>
          <h3>Éditeur de composant</h3>
          <Input value={name} onChange={(e) => setName(e.target.value)} placeholder="Nom du composant" />
          <Select
            value={type}
            onChange={(e) => setType(e.target.value)}
            options={[
              { value: 'atomique', label: 'Atomique' },
              { value: 'composé', label: 'Composé' }
            ]}
          />
          <AllowedChildrenList
            allowedChildren={allowedChildren}
            setAllowedChildren={setAllowedChildren}
          />
          <h4>Traits</h4>
          {traits.map((trait, index) => (
            <div key={index} className="trait-container">
              <Input
                value={trait.name}
                onChange={(e) => {
                  const newTraits = [...traits];
                  newTraits[index].name = e.target.value;
                  setTraits(newTraits);
                }}
                placeholder="Nom du trait"
              />
              <Select
                value={trait.type}
                onChange={(e) => {
                  const newTraits = [...traits];
                  newTraits[index].type = e.target.value;
                  setTraits(newTraits);
                }}
                options={[
                  { value: 'string', label: 'Chaîne' },
                  { value: 'number', label: 'Nombre' },
                  { value: 'boolean', label: 'Booléen' },
                  { value: 'array', label: 'Tableau' }
                ]}
              />
              <Button onClick={() => setTraits(traits.filter((_, i) => i !== index))}>
                Supprimer
              </Button>
            </div>
          ))}
          <Button onClick={() => setTraits([...traits, { name: '', type: 'string' }])}>
            Ajouter un trait
          </Button>
          <Button onClick={handleSave}>Enregistrer le composant</Button>
        </div>
      );
    };

    // rendu svg / listing crados
    const ComponentGraph = ({ component }) => {
      if (!component) return null;
      return (
        <div className="component-item">
          <h3>Graphe du composant</h3>
          <VisualComponentGraph component={component} />
          <div>
            <h4>Composant: {component.name}</h4>
            <p>Type: {component.type}</p>
            <h4>Enfants acceptés:</h4>
            <ul>
              {component.allowedChildren && component.allowedChildren.length > 0 ? (
                component.allowedChildren.map((childId) => (
                  <li key={childId}>{allComponents.find(c => c.id === childId)?.name || childId}</li>
                ))
              ) : (
                <li>Aucun enfant autorisé</li>
              )}
            </ul>
            <h4>Traits:</h4>
            <ul>
              {component.traits && component.traits.length > 0 ? (
                component.traits.map((trait, index) => (
                  <li key={index}>{trait.name}: {trait.type}</li>
                ))
              ) : (
                <li>Aucun trait défini</li>
              )}
            </ul>
          </div>
        </div>
      );
    };

    const Modal = ({ children, onClose }) => (
      <div className="modal">
        <div className="modal-content">
          {children}
          <Button onClick={onClose}>Fermer</Button>
        </div>
      </div>
    );

    const DSFRComponentPlanner = () => {
      const [selectedComponent, setSelectedComponent] = useState(null);
      const [savedComponents, setSavedComponents] = useState([]);
      const [showShareDialog, setShowShareDialog] = useState(false);
      const [shareData, setShareData] = useState('');

      useEffect(() => {
        const storedComponents = localStorage.getItem('dsfr-components');
        if (storedComponents) {
          setSavedComponents(JSON.parse(storedComponents));
        }
      }, []);

      const saveComponent = (component) => {
        const updatedComponents = savedComponents.some(c => c.id === component.id)
          ? savedComponents.map(c => c.id === component.id ? component : c)
          : [...savedComponents, component];
        setSavedComponents(updatedComponents);
        localStorage.setItem('dsfr-components', JSON.stringify(updatedComponents));
        setSelectedComponent(null);
      };

      const deleteComponent = (componentId) => {
        const updatedComponents = savedComponents.filter(c => c.id !== componentId);
        setSavedComponents(updatedComponents);
        localStorage.setItem('dsfr-components', JSON.stringify(updatedComponents));
      };

      const shareComponents = () => {
        setShareData(JSON.stringify(savedComponents));
        setShowShareDialog(true);
      };

      const handleDownloadDocumentation = () => {
        window.downloadHTMLDocumentation(savedComponents, allComponents);
      };

      /* const generateDocumentation = () => {
        let doc = '# Documentation des composants DSFR\n\n';
        savedComponents.forEach(component => {
          doc += `## ${component.name}\n\n`;
          doc += `Type: ${component.type}\n\n`;
          doc += '### Enfants autorisés:\n';
          component.allowedChildren.forEach(childId => {
            const childName = allComponents.find(c => c.id === childId)?.name || childId;
            doc += `- ${childName}\n`;
          });
          doc += '\n### Traits:\n';
          component.traits.forEach(trait => {
            doc += `- ${trait.name}: ${trait.type}\n`;
          });
          doc += '\n';
        });
        return doc;
      };

      const downloadDocumentation = () => {
        const doc = generateDocumentation();
        const blob = new Blob([doc], { type: 'text/markdown' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'dsfr-components-documentation.md';
        a.click();
      }; */

      return (
        <div className="container mx-auto p-5">
          <h1 className="text-3xl font-bold mb-6">Planificateur avancé de composants DSFR</h1>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
              <ComponentList onSelectComponent={setSelectedComponent} />
              <h3>Composants sauvegardés</h3>
              {savedComponents.map(component => (
                <div key={component.id} className="component-item">
                  <div className="space-between">
                    <span>{component.name}</span>
                    <div>
                      <Button onClick={() => setSelectedComponent(component)}>Éditer</Button>
                      <Button onClick={() => deleteComponent(component.id)}>Supprimer</Button>
                    </div>
                  </div>
                </div>
              ))}
              <Button onClick={() => setSelectedComponent({ name: '', type: 'atomique', allowedChildren: [], traits: [] })}>
                Nouveau composant
              </Button>
              <Button onClick={shareComponents}>Partager</Button>
              <Button onClick={handleDownloadDocumentation}>Générer la documentation</Button>
            </div>
            <div>
              {selectedComponent && (
                <>
                  <ComponentEditor component={selectedComponent} onSave={saveComponent} />
                  <ComponentGraph component={selectedComponent} />
                </>
              )}
            </div>
          </div>
          {showShareDialog && (
            <Modal onClose={() => setShowShareDialog(false)}>
              <h2>Partager les composants</h2>
              <p>Copiez les données ci-dessous pour les partager avec un collègue.</p>
              <textarea value={shareData} readOnly rows={10} cols={50} style={{ width: '100%', marginBottom: '10px' }} />
            </Modal>
          )}
        </div>
      );
    };

    ReactDOM.render(<DSFRComponentPlanner />, document.getElementById('root'));
  </script>
</body>

</html>